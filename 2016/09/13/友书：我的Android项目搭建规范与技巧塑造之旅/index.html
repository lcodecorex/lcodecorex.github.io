<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>友书：我的Android项目搭建规范与技巧塑造之旅 | Oscar Blog</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.2.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.0.0/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">友书：我的Android项目搭建规范与技巧塑造之旅</h1><a id="logo" href="/.">Oscar Blog</a><p class="description">成长就是学会忍受孤寂，学会自寻乐趣。</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">友书：我的Android项目搭建规范与技巧塑造之旅</h1><div class="post-meta">Sep 13, 2016<script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-thread-key="2016/09/13/友书：我的Android项目搭建规范与技巧塑造之旅/" href="/2016/09/13/友书：我的Android项目搭建规范与技巧塑造之旅/#comments" class="ds-thread-count"></a><a data-disqus-identifier="2016/09/13/友书：我的Android项目搭建规范与技巧塑造之旅/" href="/2016/09/13/友书：我的Android项目搭建规范与技巧塑造之旅/#disqus_thread" class="disqus-comment-count"></a><div class="post-content"><p>作为一个自学Android开发3年的码农，笔者此前进行过很多项目的开发，想把标题叫做项目架构，好像不太符合当前的身份，要做架构还有很长的路要走。这篇文章就献给那些初出茅庐的Android开发者，或者那些有想法想要在Android的领地上大展身手的小团队吧。笔者曾经作为Android开发的负责人，带领小兵小将团队作战。劣质的代码规范，不仅影响团队的合作，还影响团队领导者的自信心，更重要的是还影响项目的后期维护和再次开发。今天就来捋一捋我摸索到的那些规范和技巧。</p>
<h1 id="项目的基本规范"><a href="#项目的基本规范" class="headerlink" title="项目的基本规范"></a>项目的基本规范</h1><h2 id="1-使用markdown编写接口文档"><a href="#1-使用markdown编写接口文档" class="headerlink" title="1. 使用markdown编写接口文档"></a>1. 使用markdown编写接口文档</h2><p>markdown基本上是一个程序员必备的小技能，如果你还不会markdown，那得赶紧跟上时代的步伐了。这个工具可以让你爱上写作，它支持简单的文字排版，表格绘制，代码高亮显示，简单的流程图绘制，甚至你可以在github上使用hexo博客引擎轻松搭建起个人博客。个人建议使用markdown来编写接口文档：</p>
<p>头部可以写一些项目的说明，比如状态码说明（0，1，2…各状态码的含义），当前文档更新内容，或者是对项目的一些要求和总结。</p>
<p><img src="/assets/blogImg/interface_header.png" alt=""></p>
<p>然后就是正文的编写，各个接口分为请求方式，用途，参数说明，请求示例，返回结果说明等。</p>
<p><img src="/assets/blogImg/interface_content.png" alt=""></p>
<p>最后只需要在文档的开头打一个<code>[TOC]</code>标记，markdown解析器就可以生成相应的文档目录，方便查看。比起word写的文档更加方便修改和维护。</p>
<p><img src="/assets/blogImg/toc_show.png" alt=""></p>
<p>现在来说一下我使用的<strong>json返回格式规范</strong>吧。json返回内容主要分为4个部分：</p>
<ul>
<li>code : 状态码，为了方便，一般都从0开始，0表示成功，其它的可以自己定义</li>
<li>msg : 返回的消息内容，主要是错误的一些提示信息</li>
<li>obj : 返回的对象的内容，JSONObject。</li>
<li>objLists : 返回的多个对象的集合，JSONArray。</li>
</ul>
<p>这样刻意的规范对接口编写以及前端的解析都大有裨益，解析的技巧到Android开发部分再讲，比如获取书籍的简单信息的接口可以是这样的：<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    "code":200,</div><div class="line">    "msg":"成功",</div><div class="line">    "objList":[</div><div class="line">        &#123;</div><div class="line">            "cover":"http://xxx",</div><div class="line">            "author":"海明威",</div><div class="line">            "about_book":"作者莫言，作于2000年夏，杭州..."</div><div class="line">        &#125;,</div><div class="line">        &#123;...&#125;,&#123;...&#125;</div><div class="line">    ]</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="2-使用git管理代码"><a href="#2-使用git管理代码" class="headerlink" title="2. 使用git管理代码"></a>2. 使用git管理代码</h2><p>相比markdown，git更是一个开发工程师的必备技能，它的使用极大的利于团队合作，避免了重复作业。还没学过的童鞋得抓紧时间上车了。。。笔者以前使用过bitbucket，允许5个免费的团队私有项目，但经常网页刷不粗来，所以就转用国内开发团队开发的<a href="https://coding.net" target="_blank" rel="external">coding</a>，允许10个免费的私有项目。</p>
<h2 id="3-写一个正式的项目说明文档"><a href="#3-写一个正式的项目说明文档" class="headerlink" title="3. 写一个正式的项目说明文档"></a>3. 写一个正式的项目说明文档</h2><p>项目的说明文档应该随着项目的开发定期编写和汇总，它可以说明一些用到的第三库的使用方法，或者顺便记录一下项目开发中遇到的坑，比如完成了一个功能点就需要把使用到的技术记录下来，方便其它成员查看，也方便以后自己DIY写个个人博客。说明文档可以随着项目一起同步到git仓库。同样，接口文档也可以同步到git仓库，还可以顺便使用git的diff工具看看哪些地方做了修改。</p>
<p><img src="/assets/blogImg/proj_show.png" alt=""></p>
<h2 id="4-定期会议"><a href="#4-定期会议" class="headerlink" title="4. 定期会议"></a>4. 定期会议</h2><p>笔者曾经就比较讨厌开会，感觉开会是一件特别浪费时间的事情。然而，如果条件允许，是需要每天开一个晨会的，至少也需要一周开一个周会。开会干什么呢？每个小伙伴需要总结一下自己做的任务或者是学到的东西，然后进行评估，这样的会议有利于维持团队小伙伴工作的积极性，小伙伴们学到的东西可以及时的展现出来，同时也利于掌握项目的进度，进行新任务的制定。</p>
<h1 id="Android开发部分"><a href="#Android开发部分" class="headerlink" title="Android开发部分"></a>Android开发部分</h1><h2 id="1-项目搭建"><a href="#1-项目搭建" class="headerlink" title="1. 项目搭建"></a>1. 项目搭建</h2><p>笔者曾经也纠结于使用一个什么样的结构来搭建项目，MVC、MVP还是MVVM，但是个人觉得MVP这样的结构虽然设计的挺美好的，但是无端新添加了那么多类，各个接口调来调去的，看的眼花缭乱，不见得它可以增强项目的可维护性，另外对团队的其它成员也有了更高的要求，旧的项目想迁移到这个模式也是个挺费劲的事情。所以还是在MVC的基础上来做一些规范吧。对于项目搭建，也有一个非常火的开源项目来专门讲述了这件事情，详见<a href="https://github.com/android10/Android-CleanArchitecture" target="_blank" rel="external">Android-CleanArchitecture</a>。我自己采用了一个更简单易懂一些的方式。</p>
<p>如下图所示，项目主体使用模块化的思想，各模块尽量在AS中新建作为一个module，这样各模块可以单独来维护。对于主体模块，将项目分成了界面层（对应默认的app目录），核心层，接口层，模型层，为减少耦合，界面层依赖于核心层，核心层依赖于接口层，界面层、核心层、模型层都依赖于模型层。其中接口层主要是处理一些网络相关的操作，核心层可以封装一些数据库操作、文件读写等实用的方法。笔者则将核心层和接口层合为了一层。</p>
<p><img src="/assets/blogImg/proj_structure.png" alt=""></p>
<h2 id="2-接口层的JSON处理"><a href="#2-接口层的JSON处理" class="headerlink" title="2. 接口层的JSON处理"></a>2. 接口层的JSON处理</h2><p>前面已经设计了json格式的固定结构，如：<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;"code": 0, "msg": "success"&#125;</div><div class="line">&#123;"code": 0, "msg": "success", "obj":&#123;...&#125;&#125;</div><div class="line">&#123;"code": 0, "msg": "success", "objList":[&#123;...&#125;, &#123;...&#125;], "currentPage": 1, "pageSize": 20, "maxCount": 2, "maxPage": 1&#125;</div></pre></td></tr></table></figure></p>
<p>a. 现在来封装一种用来解析的实体，用上Java的六脉神剑之一——泛型，注意变量名需要和json的键名保持一致以方便解析。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApiResponse</span>&lt;<span class="title">T</span>&gt; </span>&#123;</div><div class="line">    <span class="comment">//TODO 等待确定接口返回样式</span></div><div class="line">    <span class="keyword">private</span> String code; <span class="comment">//返回的状态码</span></div><div class="line">    <span class="keyword">private</span> String msg; <span class="comment">//返回的信息，比如成功，验证码已发送等</span></div><div class="line">    <span class="keyword">private</span> T obj;           <span class="comment">// 单个对象</span></div><div class="line">    <span class="keyword">private</span> T objLists;       <span class="comment">// 数组对象</span></div><div class="line"></div><div class="line">    <span class="comment">// 判断网络请求是否成功</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isSuccess</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> code.equals(<span class="string">"0"</span>) || code.equals(<span class="string">"200"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//判断返回的是Bean还是List&lt;Bean&gt;</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isListOfT</span><span class="params">()</span> </span>&#123; <span class="comment">//当objList不为null时为真</span></div><div class="line">        <span class="keyword">return</span> objLists != <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCode</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> code;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMsg</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> msg;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">getObj</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> obj;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">getObjList</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> objLists;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>T对应的是最终需要解析出来使用的实体类。</p>
<p>b. 然后是定义对应的请求接口：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AccountAction</span> </span>&#123;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 用手机号注册</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> username 用户名</div><div class="line">     * <span class="doctag">@param</span> authcode 验证码</div><div class="line">     * <span class="doctag">@param</span> passwd   MD5加密的密码</div><div class="line">     * <span class="doctag">@param</span> phoneNum 手机号</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">(String username, String passwd, String phoneNum, String authcode, ActionCallback&lt;Void&gt; callback)</span></span>;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 登录</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> loginName 登录名（手机号）</div><div class="line">     * <span class="doctag">@param</span> password  MD5加密的密码</div><div class="line">     *                  imei      手机IMEI串号</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">login</span><span class="params">(String loginName, String password, String installation_id, ActionCallback&lt;LocalBean&gt; callback)</span></span>;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 退出登录</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">logout</span><span class="params">(ActionCallback&lt;Void&gt; listener)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">changeUserInfo</span><span class="params">(String username, String avatar, String signature, String school, String city, <span class="keyword">int</span> gender, ActionCallback&lt;Void&gt; callback)</span></span>;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 获取用户的简单信息</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> uid 想要查询的用户的id</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getSimpleUser</span><span class="params">(String uid, ActionCallback&lt;User&gt; callback)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>c. 定义接口的具体实现<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//传入参数进行网络请求相关的内容</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountImpl</span> <span class="keyword">implements</span> <span class="title">AccountAction</span> </span>&#123; ... &#125;</div></pre></td></tr></table></figure></p>
<p><strong>原来的核心层处于接口层和界面层之间，向下调用Api，向上提供Action，它的核心任务就是处理复杂的业务逻辑</strong>；现在对核心层和接口层进行了合并，接口实现类需要做接口参数合法性判断，进行网络请求，解析数据，并最终返回数据对象。合并前的项目结构可以详细查看这篇博客，<a href="http://keeganlee.me/post/android/20150629" target="_blank" rel="external">Android项目重构之路:实现篇</a></p>
<p>这里我使用了强大的okhttp来做网络请求并使用了gson做数据解析。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountImpl</span> <span class="keyword">implements</span> <span class="title">AccountAction</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> Context mContext;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AccountImpl</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.mContext = context;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">(String username, String passwd, String phoneNum, String authcode, ActionCallback&lt;Void&gt; callback)</span> </span>&#123;</div><div class="line">        <span class="keyword">new</span> OkHttpRequest.Builder()</div><div class="line">                .url(Urls.REGISTER_URL)</div><div class="line">                .addParams(<span class="string">"username"</span>, username)</div><div class="line">                .addParams(<span class="string">"passwd"</span>, passwd)</div><div class="line">                .addParams(<span class="string">"phoneNum"</span>, phoneNum)</div><div class="line">                .addParams(<span class="string">"authCode"</span>, authcode)</div><div class="line">                .post(<span class="keyword">new</span> ResponseCallback&lt;Void&gt;(callback));</div><div class="line">                <span class="comment">//ResponseCallback里面需要传参ActionCallback，解析json并对结果进行适当的处理。</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>d. 定义请求回调接口<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ActionCallback</span>&lt;<span class="title">T</span>&gt; </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(T data)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(String errorCode, String messge)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBefore</span><span class="params">()</span></span>;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAfter</span><span class="params">()</span></span>;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">inProgress</span><span class="params">(<span class="keyword">float</span> progress)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>e. App层调用接口后，最终结果会通过该回调接口返回。最终使用某一个接口的画风会是这样的：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookApplication</span> <span class="keyword">extends</span> <span class="title">Application</span></span>&#123;</div><div class="line">    <span class="keyword">private</span> AccountAction api;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> BookApplication instance;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate();</div><div class="line">        <span class="keyword">if</span>(instance == <span class="keyword">null</span>) instance = <span class="keyword">this</span>;</div><div class="line">         <span class="comment">//最好在Application的onCreate()方法中定义，不要多次创建实例</span></div><div class="line">        accountAction = <span class="keyword">new</span> AccountImpl(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> AccountAction <span class="title">getApi</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> accountAction;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//在其它地方使用接口</span></div><div class="line">api.login(<span class="keyword">new</span> ActionCallback&lt;Void&gt;()&#123;</div><div class="line">    <span class="comment">//处理结果</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<h2 id="3-定义Activity和Fragment的基类"><a href="#3-定义Activity和Fragment的基类" class="headerlink" title="3. 定义Activity和Fragment的基类"></a>3. 定义Activity和Fragment的基类</h2><p>a. BaseActivity:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> Context mContext;</div><div class="line">    <span class="keyword">public</span> BookApplication application;</div><div class="line">    <span class="keyword">public</span> AccountAction accountAction;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line"></div><div class="line">        ActivitysManager.getInstanse().add(<span class="keyword">this</span>);</div><div class="line">        mContext = <span class="keyword">this</span>;</div><div class="line">        application = (BookApplication) getApplication();</div><div class="line">        accountAction = application.getAccountAction();</div><div class="line"></div><div class="line">        setContentView(setInflateId());</div><div class="line">        ButterKnife.bind(<span class="keyword">this</span>);</div><div class="line">        init();</div><div class="line">        initAcition();</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onDestroy();</div><div class="line">        ActivitysManager.getInstanse().killActivity(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//设置布局id</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">int</span> <span class="title">setInflateId</span><span class="params">()</span></span>;</div><div class="line">    <span class="comment">//视图，组件,数据的初始化</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>;</div><div class="line">    <span class="comment">//事件监听</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initAcition</span><span class="params">()</span></span>&#123;&#125;</div><div class="line"></div><div class="line">    <span class="comment">//Activity设置带返回按钮的Toolbar</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setupBackToolbar</span><span class="params">(String title)</span></span>&#123;</div><div class="line">        setupBackToolbar(R.id.toolbar,title);</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//id不同的需要自行传入</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setupBackToolbar</span><span class="params">(<span class="keyword">int</span> toolbarId,String title)</span></span>&#123;</div><div class="line">        Toolbar mToolbar = (Toolbar) findViewById(toolbarId);</div><div class="line">        setSupportActionBar(mToolbar);</div><div class="line">        getSupportActionBar().setHomeButtonEnabled(<span class="keyword">true</span>); <span class="comment">//显示小箭头</span></div><div class="line">        getSupportActionBar().setDisplayHomeAsUpEnabled(<span class="keyword">true</span>);</div><div class="line">        mToolbar.setNavigationIcon(R.drawable.btn_back2);</div><div class="line">        mToolbar.setNavigationOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">                onBackPressed();</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        setTitle(title);</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//以下为常用方法</span></div><div class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showToast</span><span class="params">(String msg)</span></span>&#123;</div><div class="line">         <span class="keyword">if</span>(TextUtils.isEmpty(msg)) <span class="keyword">return</span>;</div><div class="line">         Toast.makeText(mContext, msg, Toast.LENGTH_SHORT).show();</div><div class="line">     &#125;</div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">startActivity</span><span class="params">(Class&lt;?&gt; cls)</span> </span>&#123;</div><div class="line">        Intent intent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, cls);</div><div class="line">        startActivity(intent);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startActivity</span><span class="params">(Class&lt;?&gt; cls, String... objs)</span> </span>&#123;</div><div class="line">        Intent intent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, cls);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; objs.length; i++) &#123;</div><div class="line">            intent.putExtra(objs[i], objs[++i]);</div><div class="line">        &#125;</div><div class="line">        startActivity(intent);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这里的技巧就是：</p>
<ol>
<li>使用自定一个Activity栈管理器（ActivitysManager），在onCreate的时候将activity加入到栈中，在onDestroy时将activity移除栈，把这些操作写在基类中可以使子类进栈出栈自动进行，无需冗余代码。</li>
<li>把BaseActivity作为抽象类，提取出抽象的setInflateId()和init()方法（当然使用接口类也可以）</li>
<li>使用ButterKnife绑定View</li>
</ol>
<p>b. BaseFragment:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseFragment</span> <span class="keyword">extends</span> <span class="title">Fragment</span> <span class="keyword">implements</span> <span class="title">View</span>.<span class="title">OnTouchListener</span></span>&#123;</div><div class="line">    <span class="keyword">private</span> View rootView;</div><div class="line">    <span class="meta">@Nullable</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">onCreateView</span><span class="params">(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span>(<span class="keyword">null</span> == rootView)&#123;</div><div class="line">            rootView = inflater.inflate(setInflateId(), container, <span class="keyword">false</span>);</div><div class="line">            rootView.setOnTouchListener(<span class="keyword">this</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> rootView;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onActivityCreated</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onActivityCreated(savedInstanceState);</div><div class="line">        ButterKnife.bind(<span class="keyword">this</span>,rootView);</div><div class="line">        init();</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onDestroy();</div><div class="line">        BookApplication.getRefWatcher(getActivity()).watch(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouch</span><span class="params">(View v, MotionEvent event)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">int</span> <span class="title">setInflateId</span><span class="params">()</span></span>;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>BaseFragment和BaseActivity代码类似，为了防止Fragment出现点击穿透的现象，需要实现OnTouchListener。</p>
<p>c. 带有刷新、加载更多、缺省显示的专用于列表展示的Fragment：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseRecyclerFragment</span>&lt;<span class="title">Bean</span>&gt; <span class="keyword">extends</span> <span class="title">BaseFragment</span> <span class="keyword">implements</span> <span class="title">ActionCallback</span>&lt;<span class="title">List</span>&lt;<span class="title">Bean</span>&gt;&gt; </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Bind</span>(R.id.recyclerView)</div><div class="line">    <span class="keyword">public</span> HaoRecyclerView recyclerView;</div><div class="line"></div><div class="line">    <span class="meta">@Bind</span>(R.id.swiperefresh)</div><div class="line">    <span class="keyword">public</span> SwipeRefreshLayout swipeRefresh;</div><div class="line"></div><div class="line">    <span class="meta">@Bind</span>(R.id.empty_view)</div><div class="line">    View emptyView;</div><div class="line"></div><div class="line">    <span class="meta">@Bind</span>(R.id.iv_default)</div><div class="line">    ImageView iv_empty;</div><div class="line"></div><div class="line">    <span class="meta">@Bind</span>(R.id.tv_default)</div><div class="line">    TextView tv_empty;</div><div class="line"></div><div class="line">    <span class="meta">@OnClick</span>(R.id.empty_view)</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">emptyClick</span><span class="params">()</span> </span>&#123;</div><div class="line">        toRefresh();</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> STATE_REFRESH = <span class="number">0</span>;</div><div class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> STATE_LOADMORE = <span class="number">1</span>;</div><div class="line">    <span class="keyword">protected</span> <span class="keyword">int</span> state = STATE_REFRESH; <span class="comment">//默认刷新模式</span></div><div class="line">    <span class="keyword">protected</span> <span class="keyword">boolean</span> showFailureToast = <span class="keyword">true</span>;</div><div class="line"></div><div class="line">    <span class="keyword">protected</span> SwipeRefreshLayout.OnRefreshListener listener;</div><div class="line"></div><div class="line">    <span class="keyword">protected</span> BaseRecyclerAdapter&lt;Bean&gt; adapter;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">setInflateId</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> R.layout.fragment_recycler;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">        recyclerView.setLayoutManager(<span class="keyword">new</span> LinearLayoutManager(getActivity()));</div><div class="line">        adapter = setAdapter();</div><div class="line">        recyclerView.setAdapter(adapter);</div><div class="line">        recyclerView.setCanloadMore(<span class="keyword">false</span>);<span class="comment">//默认不能加载更多,item数量达到pageItemCount时再允许</span></div><div class="line">        <span class="keyword">if</span> (canLoadmore()) &#123;</div><div class="line">            pageItemCount = <span class="number">15</span>; <span class="comment">//默认加载15页</span></div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            pageItemCount = <span class="number">2000</span>;</div><div class="line">        &#125;</div><div class="line">        initAction();</div><div class="line">        initRefreshLayout();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> enableResumeRefresh = <span class="keyword">false</span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">enableResumeRefresh</span><span class="params">(<span class="keyword">boolean</span> enableResumeRefresh)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.enableResumeRefresh = enableResumeRefresh;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">int</span> resumeCount = <span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResume</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onResume();</div><div class="line">        <span class="keyword">if</span> (resumeCount == <span class="number">0</span>) &#123;</div><div class="line">            <span class="comment">//自动刷新</span></div><div class="line">            swipeRefresh.post(<span class="keyword">new</span> Runnable() &#123;</div><div class="line">                <span class="meta">@Override</span></div><div class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">                    <span class="keyword">if</span> (swipeRefresh != <span class="keyword">null</span>) swipeRefresh.setRefreshing(<span class="keyword">true</span>);</div><div class="line">                &#125;</div><div class="line">            &#125;);</div><div class="line">            listener.onRefresh();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (resumeCount &lt; <span class="number">2</span>) resumeCount++;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (enableResumeRefresh) &#123;</div><div class="line">            <span class="keyword">if</span> (resumeCount &gt; <span class="number">1</span> &amp;&amp; currentPage == <span class="number">1</span>) &#123;</div><div class="line">                <span class="comment">//resume执行多次了,且当前在显示第一页则刷新</span></div><div class="line">                swipeRefresh.post(<span class="keyword">new</span> Runnable() &#123;</div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">                        <span class="keyword">if</span> (swipeRefresh != <span class="keyword">null</span>) swipeRefresh.setRefreshing(<span class="keyword">true</span>);</div><div class="line">                    &#125;</div><div class="line">                &#125;);</div><div class="line">                listener.onRefresh();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> BaseRecyclerAdapter&lt;Bean&gt; <span class="title">setAdapter</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">boolean</span> <span class="title">canLoadmore</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="comment">//ItemAnimator,加载数据等操作,事件处理等</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">initAction</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="comment">//下拉刷新</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">toRefresh</span><span class="params">()</span> </span>&#123;</div><div class="line">        state = STATE_REFRESH;</div><div class="line">        hideDefaultView();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//加载更多</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">toLoadMore</span><span class="params">()</span> </span>&#123;</div><div class="line">        state = STATE_LOADMORE;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEmptyView</span><span class="params">(<span class="keyword">int</span> drawableId, String text)</span> </span>&#123;</div><div class="line">        setEmptyImg(drawableId);</div><div class="line">        setEmptyText(text);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEmptyText</span><span class="params">(String text)</span> </span>&#123;</div><div class="line">        tv_empty.setText(text);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEmptyImg</span><span class="params">(<span class="keyword">int</span> drawableId)</span> </span>&#123;</div><div class="line">        iv_empty.setImageResource(drawableId);</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hideDefaultView</span><span class="params">()</span> </span>&#123;</div><div class="line">        emptyView.setVisibility(View.GONE);</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initRefreshLayout</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">//设置自定义加载中和到底了效果</span></div><div class="line">        swipeRefresh.setColorSchemeResources(R.color.colorPrimary);</div><div class="line">        swipeRefresh.setProgressViewOffset(<span class="keyword">true</span>, -<span class="number">20</span>, <span class="number">100</span>);</div><div class="line"></div><div class="line">        ProgressView progressView = <span class="keyword">new</span> ProgressView(getContext());</div><div class="line">        progressView.setIndicatorId(ProgressView.BallPulse);</div><div class="line">        progressView.setIndicatorColor(getResources().getColor(R.color.titleColorPrimary));<span class="comment">//0xff69b3e0</span></div><div class="line">        recyclerView.setFootLoadingView(progressView);</div><div class="line">        setSwipeRefreshListener();</div><div class="line">        swipeRefresh.setOnRefreshListener(listener);</div><div class="line"></div><div class="line">        recyclerView.setLoadMoreListener(<span class="keyword">new</span> LoadMoreListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onLoadMore</span><span class="params">()</span> </span>&#123;</div><div class="line">                toLoadMore();</div><div class="line">                <span class="keyword">new</span> Handler().postDelayed(<span class="keyword">new</span> Runnable() &#123;</div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">                        <span class="keyword">if</span> (recyclerView != <span class="keyword">null</span>) recyclerView.loadMoreComplete();</div><div class="line">                    &#125;</div><div class="line">                &#125;, <span class="number">1000</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSwipeRefreshListener</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.listener = <span class="keyword">new</span> SwipeRefreshLayout.OnRefreshListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onRefresh</span><span class="params">()</span> </span>&#123;</div><div class="line">                toRefresh();</div><div class="line">                recyclerView.loadMoreComplete();</div><div class="line">                <span class="keyword">new</span> Handler().postDelayed(<span class="keyword">new</span> Runnable() &#123;</div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">                        <span class="keyword">if</span> (swipeRefresh != <span class="keyword">null</span>) swipeRefresh.setRefreshing(<span class="keyword">false</span>);</div><div class="line">                        <span class="keyword">if</span> (recyclerView != <span class="keyword">null</span>) recyclerView.refreshComplete();</div><div class="line">                    &#125;</div><div class="line">                &#125;, <span class="number">1000</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">protected</span> <span class="keyword">int</span> pageItemCount = <span class="number">2000</span>; <span class="comment">//单页显示数量  数量大表示是单页显示模式</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPageItemCount</span><span class="params">(<span class="keyword">int</span> count)</span> </span>&#123;<span class="comment">//可不必调用</span></div><div class="line">        pageItemCount = count;  <span class="comment">//单页显示的Fragment不用调用此方法</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">protected</span> <span class="keyword">boolean</span> enableEmptyView = <span class="keyword">true</span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showDefaultView</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (enableEmptyView)</div><div class="line">            emptyView.setVisibility(View.VISIBLE);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">protected</span> <span class="keyword">int</span> currentPage = <span class="number">1</span>; <span class="comment">//标识当前加载的分页</span></div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(List&lt;Bean&gt; datas)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (datas!=<span class="keyword">null</span>)&#123;</div><div class="line">            Log.d(<span class="string">"TAG"</span>, <span class="string">"onSuccess: "</span>+datas.size());</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (datas != <span class="keyword">null</span> &amp;&amp; datas.size() &gt;= pageItemCount) &#123;</div><div class="line">            <span class="comment">//获取到的数量足够才允许加载更多</span></div><div class="line">            recyclerView.setCanloadMore(<span class="keyword">true</span>);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            recyclerView.setCanloadMore(<span class="keyword">false</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (state == STATE_REFRESH) &#123;<span class="comment">//刷新模式currentPage置1</span></div><div class="line">            currentPage = <span class="number">1</span>;</div><div class="line">            <span class="keyword">if</span> (datas == <span class="keyword">null</span> || datas.size() == <span class="number">0</span>) &#123;</div><div class="line">                showDefaultView();</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                hideDefaultView();</div><div class="line">            &#125;</div><div class="line">            adapter.setDataList(datas);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;<span class="comment">//加载更多模式currentPage自增</span></div><div class="line">            currentPage++;</div><div class="line">            adapter.addItems(datas);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(String errorCode, String message)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (!TextUtils.isEmpty(message)) &#123;</div><div class="line">            <span class="keyword">if</span> (showFailureToast) showToast(message);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (adapter.getItemCount() &lt;= <span class="number">0</span>) &#123;</div><div class="line">            showDefaultView();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBefore</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAfter</span><span class="params">()</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">inProgress</span><span class="params">(<span class="keyword">float</span> progress)</span> </span>&#123;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (adapter.getItemCount() &lt;= <span class="number">0</span>) &#123;</div><div class="line">            showDefaultView();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setShowFailureToast</span><span class="params">(<span class="keyword">boolean</span> isShowFailureToast)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.showFailureToast = isShowFailureToast;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这个类需要配合layout一起使用，主要的用处有：</p>
<ol>
<li>setPageItemCount() 设置单页显示数量</li>
<li>setEmptyView()  定义缺省显示图标</li>
<li>enableResumeRefresh() 是否允许在onResume()中刷新页面</li>
<li>showDefaultView() 是否允许没有数据的时候显示缺省图标</li>
<li>canLoadmore() 是否可以加载更多，默认是单页加载模式，即不分页，要想分页只需调用setPageItemCount()方法设置单页显示数量即可</li>
</ol>
<p>然后一个子类的画风会是这样的：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookFinishedFragment</span> <span class="keyword">extends</span> <span class="title">BaseRecyclerFragment</span>&lt;<span class="title">BorrowBook</span>&gt; </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> BaseRecyclerAdapter <span class="title">setAdapter</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BookHistoryAdapter();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">canLoadmore</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initAction</span><span class="params">()</span> </span>&#123;</div><div class="line">        BookApplication.getInstance().getAccountAction().getHistoryList(<span class="number">2</span>,<span class="number">15</span>,<span class="number">1</span>,<span class="keyword">this</span>);</div><div class="line">        setShowFailureToast(<span class="keyword">false</span>); <span class="comment">//禁止出现返回失败的toast</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">toRefresh</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.toRefresh();</div><div class="line">        BookApplication.getInstance().getAccountAction().getHistoryList(<span class="number">2</span>,<span class="number">15</span>,<span class="number">1</span>,<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">toLoadMore</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.toLoadMore();</div><div class="line">        BookApplication.getInstance().getAccountAction().getHistoryList(<span class="number">2</span>,<span class="number">15</span>, currentPage + <span class="number">1</span>, BookFinishedFragment.<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>有木有，几十行代码搞定了。当然adapter的实现就另当别论了（同样有干货技巧）。</p>
<blockquote>
<p>另外对于在RecyclerView上实现刷新和加载更多的实现方法，目前有两种方式，一种是直接修改RecyclerView，一种是增加一个父级View，比如SwipeRefreshLayout。笔者比较推荐第二种方式，或者用一个子类继承RecyclerView,RecyclerView由官方继续维护和更新。</p>
</blockquote>
<h2 id="4-自定义强大的Adapter"><a href="#4-自定义强大的Adapter" class="headerlink" title="4. 自定义强大的Adapter"></a>4. 自定义强大的Adapter</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseRecyclerAdapter</span>&lt;<span class="title">T</span>&gt; <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">Adapter</span>&lt;<span class="title">RecyclerView</span>.<span class="title">ViewHolder</span>&gt; <span class="keyword">implements</span> <span class="title">CommonHolder</span>.<span class="title">OnNotifyChangeListener</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> List&lt;T&gt; dataList = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> enableHead = <span class="keyword">false</span>;</div><div class="line">    CommonHolder headHolder;</div><div class="line"></div><div class="line">    ViewGroup rootView;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> TYPE_HEAD = <span class="number">0</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TYPE_CONTENT = <span class="number">1</span>;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> RecyclerView.<span class="function">ViewHolder <span class="title">onCreateViewHolder</span><span class="params">(ViewGroup parent, <span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">        rootView = parent;</div><div class="line">        <span class="comment">//设置ViewHolder</span></div><div class="line">        <span class="keyword">int</span> type = getItemViewType(position);</div><div class="line">        <span class="keyword">if</span> (type == TYPE_HEAD) &#123;</div><div class="line">            <span class="keyword">return</span> headHolder;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span> setViewHolder(parent);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBindViewHolder</span><span class="params">(RecyclerView.ViewHolder holder, <span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">        runEnterAnimation(holder.itemView, position);</div><div class="line">        <span class="comment">//数据绑定</span></div><div class="line">        <span class="keyword">if</span> (enableHead) &#123;</div><div class="line">            <span class="keyword">if</span> (position == <span class="number">0</span>) &#123;</div><div class="line">                <span class="comment">//((CommonHolder) holder).bindData(null);//头部不填充数据</span></div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                ((CommonHolder) holder).bindData(dataList.get(position - <span class="number">1</span>));</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            ((CommonHolder) holder).bindData(dataList.get(position));</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        ((CommonHolder) holder).setOnNotifyChangeListener(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> ViewGroup <span class="title">getRootView</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> rootView;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getItemCount</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (enableHead) &#123;</div><div class="line">            <span class="keyword">return</span> dataList.size() + <span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> dataList.size();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getItemViewType</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (enableHead) &#123;</div><div class="line">            <span class="keyword">if</span> (position == <span class="number">0</span>) &#123;</div><div class="line">                <span class="keyword">return</span> TYPE_HEAD;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="keyword">return</span> TYPE_CONTENT;</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span> TYPE_CONTENT;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> lastAnimatedPosition = -<span class="number">1</span>;</div><div class="line">    <span class="keyword">protected</span> <span class="keyword">boolean</span> animationsLocked = <span class="keyword">false</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> delayEnterAnimation = <span class="keyword">true</span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">runEnterAnimation</span><span class="params">(View view, <span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (animationsLocked) <span class="keyword">return</span>;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (position &gt; lastAnimatedPosition) &#123;</div><div class="line">            lastAnimatedPosition = position;</div><div class="line">            view.setTranslationY(DensityUtil.dip2px(view.getContext(), <span class="number">100</span>));<span class="comment">//(position+1)*50f</span></div><div class="line">            view.setAlpha(<span class="number">0</span>.f);</div><div class="line">            view.animate()</div><div class="line">                    .translationY(<span class="number">0</span>).alpha(<span class="number">1</span>.f)</div><div class="line">                    .setStartDelay(delayEnterAnimation ? <span class="number">20</span> * (position) : <span class="number">0</span>)</div><div class="line">                    .setInterpolator(<span class="keyword">new</span> DecelerateInterpolator(<span class="number">2</span>.f))</div><div class="line">                    .setDuration(<span class="number">500</span>)</div><div class="line">                    .setListener(<span class="keyword">new</span> AnimatorListenerAdapter() &#123;</div><div class="line">                        <span class="meta">@Override</span></div><div class="line">                        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationEnd</span><span class="params">(Animator animation)</span> </span>&#123;</div><div class="line">                            animationsLocked = <span class="keyword">true</span>;</div><div class="line">                        &#125;</div><div class="line">                    &#125;).start();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNotify</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">//提供给CommonHolder方便刷新视图</span></div><div class="line">        notifyDataSetChanged();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDataList</span><span class="params">(List&lt;T&gt; datas)</span> </span>&#123;</div><div class="line">        dataList.clear();</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != datas) &#123;</div><div class="line">            dataList.addAll(datas);</div><div class="line">        &#125;</div><div class="line">        notifyDataSetChanged();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clearDatas</span><span class="params">()</span> </span>&#123;</div><div class="line">        dataList.clear();</div><div class="line">        notifyDataSetChanged();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 添加数据到前面</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addItemsAtFront</span><span class="params">(List&lt;T&gt; datas)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == datas) <span class="keyword">return</span>;</div><div class="line">        dataList.addAll(<span class="number">0</span>, datas);</div><div class="line">        notifyDataSetChanged();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 添加数据到尾部</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addItems</span><span class="params">(List&lt;T&gt; datas)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == datas) <span class="keyword">return</span>;</div><div class="line">        dataList.addAll(datas);</div><div class="line">        notifyDataSetChanged();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 添加单条数据</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addItem</span><span class="params">(T data)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == data) <span class="keyword">return</span>;</div><div class="line">        dataList.add(data);</div><div class="line">        notifyDataSetChanged();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 删除单条数据</div><div class="line">     */</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deletItem</span><span class="params">(T data)</span> </span>&#123;</div><div class="line">        dataList.remove(data);</div><div class="line">        Log.d(<span class="string">"deletItem: "</span>, dataList.remove(data) + <span class="string">""</span>);</div><div class="line">        notifyDataSetChanged();</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 设置是否显示head</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> ifEnable 是否显示头部</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEnableHead</span><span class="params">(<span class="keyword">boolean</span> ifEnable)</span> </span>&#123;</div><div class="line">        enableHead = ifEnable;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHeadHolder</span><span class="params">(CommonHolder headHolder1)</span> </span>&#123;</div><div class="line">        enableHead = <span class="keyword">true</span>;</div><div class="line">        headHolder = headHolder1;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHeadHolder</span><span class="params">(View itemView)</span> </span>&#123;</div><div class="line">        enableHead = <span class="keyword">true</span>;</div><div class="line">        headHolder = <span class="keyword">new</span> HeadHolder(itemView);</div><div class="line">        notifyItemInserted(<span class="number">0</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> CommonHolder <span class="title">getHeadHolder</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> headHolder;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 子类重写实现自定义ViewHolder</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> CommonHolder&lt;T&gt; <span class="title">setViewHolder</span><span class="params">(ViewGroup parent)</span></span>;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">HeadHolder</span> <span class="keyword">extends</span> <span class="title">CommonHolder</span>&lt;<span class="title">Void</span>&gt; </span>&#123;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="title">HeadHolder</span><span class="params">(View itemView)</span> </span>&#123;</div><div class="line">            <span class="keyword">super</span>(itemView);</div><div class="line">            ButterKnife.bind(<span class="keyword">this</span>, itemView);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">bindData</span><span class="params">(Void aVoid)</span> </span>&#123;<span class="comment">//不用实现</span></div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>实际上RecyclerView本身的Adapter就挺强大的，这里进行了进一步的封装。首先是提取出来了一个CommonHolder，BaseRecyclerAdapter的子类只需要实现setViewHolder()方法即可；另外该Adapter还支持添加一个Header；支持在CommonHolder中调用notifyChange()方法来通知Adapter某一个Item发生了改变。</p>
<p>你可能觉得这样的改动意义不大，但是当遇到这样的场景。比如你在做一个聊天页面，聊天消息的格式有纯文本，有图片，有语音或者是其它的格式，并且对一种类型的消息也有发送者和接受者两种形式，如果是在一个Adapter中编写，肯定代码一不小心就是几千行，而且各种id，各种事件，代码的可读性简直惨不忍睹。如果采用我的这种方式呢，它就会是另外一种画风。比如你可以定义一个TextHolder,ImageHolder,VoiceHolder，每个类几百行代码，可读性提升的不是一点点。如下所示：</p>
<p>聊天页面适配器：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ImMultiItemAdapter</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">Adapter</span>&lt;<span class="title">RecyclerView</span>.<span class="title">ViewHolder</span>&gt; </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> ITEM_LEFT = <span class="number">0</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> ITEM_RIGHT = <span class="number">1</span>;</div><div class="line">    RightHolder.MsgErrorResendAction errorResendAction;</div><div class="line">    <span class="comment">// 时间间隔最小为十分钟</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> TIME_INTERVAL = <span class="number">10</span> * <span class="number">60</span> * <span class="number">1000</span>;</div><div class="line">    <span class="keyword">private</span> List&lt;AVIMMessage&gt; messageList = <span class="keyword">new</span> ArrayList&lt;AVIMMessage&gt;();</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> RecyclerView.<span class="function">ViewHolder <span class="title">onCreateViewHolder</span><span class="params">(ViewGroup parent, <span class="keyword">int</span> viewType)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (viewType == ITEM_LEFT) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> LeftHolder(parent.getContext(), parent);</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (viewType == ITEM_RIGHT) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> RightHolder(parent.getContext(), parent);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="comment">//TODO</span></div><div class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBindViewHolder</span><span class="params">(RecyclerView.ViewHolder holder, <span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">        ((CommonHolder)holder).bindData(messageList.get(position));</div><div class="line">        <span class="keyword">if</span> (holder <span class="keyword">instanceof</span> LeftHolder) &#123;</div><div class="line">            ((LeftHolder)holder).showTimeView(shouldShowTime(position));</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (holder <span class="keyword">instanceof</span> RightHolder) &#123;</div><div class="line">            ((RightHolder)holder).showTimeView(shouldShowTime(position));</div><div class="line">            <span class="keyword">if</span>(errorResendAction != <span class="keyword">null</span>)&#123;</div><div class="line">                ((RightHolder)holder).setMsgErrorResendAction(errorResendAction);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getItemViewType</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">        AVIMMessage message = messageList.get(position);</div><div class="line">        <span class="keyword">if</span> (message.getFrom().equals(ChatManager.getInstance().getSelfId())) &#123;</div><div class="line">            <span class="keyword">return</span> ITEM_RIGHT;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span> ITEM_LEFT;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>当然我这里偷工减料写成了LeftHolder跟RightHolder两种Holder:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LeftHolder</span> <span class="keyword">extends</span> <span class="title">CommonHolder</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Bind</span>(R.id.tv_time)</div><div class="line">    <span class="keyword">protected</span> TextView timeView;</div><div class="line"></div><div class="line">    <span class="meta">@Bind</span>(R.id.tv_content)</div><div class="line">    <span class="keyword">protected</span> TextView contentView;</div><div class="line"></div><div class="line">    <span class="meta">@Bind</span>(R.id.iv_photo)</div><div class="line">    <span class="keyword">protected</span> ImageView iv_photo;</div><div class="line"></div><div class="line">    <span class="meta">@Bind</span>(R.id.avatar)</div><div class="line">    CircleImageView avatar;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LeftHolder</span><span class="params">(Context context, ViewGroup root)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, root, R.layout.item_chat_left);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@OnClick</span>(R.id.tv_content)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onContentClick</span><span class="params">()</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">bindData</span><span class="params">(Object o)</span> </span>&#123;</div><div class="line">        <span class="keyword">final</span> AVIMMessage message = (AVIMMessage) o;</div><div class="line">        SimpleDateFormat dateFormat = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy年MM月dd日 HH:mm"</span>);</div><div class="line">        String time = dateFormat.format(message.getTimestamp());</div><div class="line"></div><div class="line">        String content = getContext().getString(R.string.im_unknown);</div><div class="line">        <span class="keyword">if</span> (message <span class="keyword">instanceof</span> AVIMTextMessage) &#123;</div><div class="line">            content = ((AVIMTextMessage) message).getText();</div><div class="line">            contentView.setText(content);</div><div class="line">            contentView.setVisibility(View.VISIBLE);</div><div class="line">            iv_photo.setVisibility(View.GONE);</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (message <span class="keyword">instanceof</span> AVIMImageMessage) &#123;</div><div class="line">            <span class="comment">//...</span></div><div class="line"></div><div class="line">            iv_photo.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</div><div class="line">                <span class="meta">@Override</span></div><div class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">                    ArrayList&lt;String&gt; pics = <span class="keyword">new</span> ArrayList&lt;String&gt;();</div><div class="line">                    pics.add(toLoadPicPath);</div><div class="line"></div><div class="line">                    <span class="keyword">int</span>[] location = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span>];</div><div class="line">                    iv_photo.getLocationOnScreen(location);</div><div class="line">                    <span class="keyword">int</span> width = iv_photo.getWidth();</div><div class="line">                    <span class="keyword">int</span> height = iv_photo.getHeight();</div><div class="line">                    PhotoViewActivity.showWithParams(getContext(), pics, <span class="number">0</span>, width, height, location[<span class="number">0</span>], location[<span class="number">1</span>]);</div><div class="line">                &#125;</div><div class="line">            &#125;);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        timeView.setText(time);</div><div class="line"></div><div class="line">        UserHelper.getInstance().loadAvatar(avatar, UserHelper.getInstance().getAvatar(message.getFrom()));</div><div class="line">        avatar.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">                UserDetailActivity.launch((Activity) getContext(), message.getFrom());</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showTimeView</span><span class="params">(<span class="keyword">boolean</span> isShow)</span> </span>&#123;</div><div class="line">        timeView.setVisibility(isShow ? View.VISIBLE : View.GONE);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>同样也是几十行代码搞定了，而且代码的编写也很简单，在构造函数中绑定View的id，在bindData()方法中绑定数据或者处理业务逻辑。</p>
<h2 id="其它规范和技巧"><a href="#其它规范和技巧" class="headerlink" title="其它规范和技巧"></a>其它规范和技巧</h2><h4 id="1-layout文件命名规范"><a href="#1-layout文件命名规范" class="headerlink" title="1. layout文件命名规范"></a>1. layout文件命名规范</h4><p>随着项目的膨胀，layout文件必然很多，没有个规范是不行的。比如可以采用这样的方式：</p>
<ul>
<li>Activity的layout文件以<code>activity_</code>为前缀,甚至是<code>activity_share_</code>,share为Activity所属的业务范围，比如这里的share表示分享相关的Activity</li>
<li>dialog相关layout使用<code>dialog_</code>为前缀</li>
<li>需要包含在其它layout中的公用布局文件使用<code>inc_</code>为前缀</li>
<li>友盟分享layoout使用<code>umeng_</code>为前缀</li>
<li>自定义View类使用<code>view_</code>为前缀</li>
<li>适配器相关的布局文件使用<code>item_</code>为前缀</li>
</ul>
<h4 id="2-项目结构"><a href="#2-项目结构" class="headerlink" title="2. 项目结构"></a>2. 项目结构</h4><p>此处以我做的一个项目的结构来做说明。先看app目录，im、wxapi、zxing都是几个小模块，views中是一些自定义view</p>
<p><img src="/assets/blogImg/app_root.png" alt=""></p>
<p>再看ui目录，笔者把app界面的入口（SplashActivity、LoginActivity、MainActivity）放这了，再也不用漫天找入口了。然后account、book、share这些都是按照业务分的目录。account表示账户相关的操作，神马修改密码、查看用户资料全在这了；book表示书籍相关类，比如书籍列表、书籍详情；share表示分享相关的业务，比如分享圈、评论、点赞逻辑都在这了！看着就一目了然有木有！！！</p>
<p><img src="/assets/blogImg/app_ui.png" alt=""></p>
<h4 id="3-Activity间跳转"><a href="#3-Activity间跳转" class="headerlink" title="3. Activity间跳转"></a>3. Activity间跳转</h4><p>笔者在项目中规定，有需要通过intent传参跳转Activity的，必须在要跳转到的Activity里面定义一个static方法，把参数名什么的放里面。<br>比如笔者需要从一个书籍列表展示页面跳转到详情页面，可以在BookDetailActivity这么搞：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">launch</span><span class="params">(Activity activity, String lid)</span> </span>&#123;</div><div class="line">        Intent intent = <span class="keyword">new</span> Intent(activity, BookDetailActivity.class);</div><div class="line">        intent.putExtra(<span class="string">"lid"</span>, lid);</div><div class="line">        activity.startActivity(intent);</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>启动BookDetailActivity则必须调用这条方法。这样做一是为了防止非法的打开一个需要传参的Activity，二是跳转的参数名直接写在了要跳转到的Activity，防止传参错误，同时也更容易去检查这种错误。</p>
<h4 id="4-AndroidManifest-xml文件规范"><a href="#4-AndroidManifest-xml文件规范" class="headerlink" title="4. AndroidManifest.xml文件规范"></a>4. AndroidManifest.xml文件规范</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">    <span class="attr">package</span>=<span class="string">"com.huiman.bookfarm"</span>&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.ACCESS_NETWORK_STATE"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.WRITE_EXTERNAL_STORAGE"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.VIBRATE"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.READ_CONTACTS"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.KILL_BACKGROUND_PROCESSES"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.INTERNET"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.READ_PHONE_STATE"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.ACCESS_WIFI_STATE"</span> /&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">application</span></span></div><div class="line">        <span class="attr">android:name</span>=<span class="string">".BookApplication"</span></div><div class="line">        <span class="attr">android:allowBackup</span>=<span class="string">"true"</span></div><div class="line">        <span class="attr">android:icon</span>=<span class="string">"@mipmap/logo"</span></div><div class="line">        <span class="attr">android:label</span>=<span class="string">"@string/app_name"</span></div><div class="line">        <span class="attr">android:theme</span>=<span class="string">"@style/AppTheme"</span>&gt;</div><div class="line">        <span class="comment">&lt;!-- ***************** meta-data 配置 ******************************************** --&gt;</span></div><div class="line"></div><div class="line">        <span class="comment">&lt;!-- ********************* Activity配置****************************************** --&gt;</span></div><div class="line"></div><div class="line">        <span class="comment">&lt;!-- ***************** Service、BroadcastReceiver配置 ******************************* --&gt;</span></div><div class="line"></div><div class="line">        <span class="comment">&lt;!-- ***************** 使用到的第三方sdk组件配置 ******************************* --&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">application</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></div></pre></td></tr></table></figure>
<p>文件大致分为以上四个部分，各个组件上面需要有功能说明。</p>
<h4 id="5-从一个主题的角度来看待页面的文字和配色属性"><a href="#5-从一个主题的角度来看待页面的文字和配色属性" class="headerlink" title="5. 从一个主题的角度来看待页面的文字和配色属性"></a>5. 从一个主题的角度来看待页面的文字和配色属性</h4><p>设想现在有了新的需求，原来的单主题的UI界面需要多添加几个主题，比如需要增加夜间模式，如果没有相应的规范来约束，改起来必定是相当头疼。不如从创建一个项目开始就把它设想成是一个多主题的应用，这样你所有的界面的字体大小，背景颜色等都会属于这一套主题，这回无形中规范你的value中属性的命名。</p>
<p>给Activity切换主题需要使用setTheme(R.style.ThemeDay)这一条方法，你定义的style则是这样的：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"ThemeDay"</span>&gt;</span><span class="xml"></span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"main_bg"</span>&gt;</span>@color/bg_white<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"content_bg"</span>&gt;</span>@color/content_light<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"text_color1"</span>&gt;</span>@color/text_dark1<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"text_color2"</span>&gt;</span>@color/text_dark2<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"text_color3"</span>&gt;</span>@color/text_dark3<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"text_color4"</span>&gt;</span>@color/text_dark3<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"bg2"</span>&gt;</span>@color/bg_light2<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"bg_toolbar"</span>&gt;</span>@color/bg_white<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"ThemeNight"</span>&gt;</span><span class="xml"></span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"main_bg"</span>&gt;</span>@color/bg_dark_content<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"content_bg"</span>&gt;</span>@color/bg_dark<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"text_color1"</span>&gt;</span>@color/text_dark4<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"text_color2"</span>&gt;</span>@color/text_dark3<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"text_color3"</span>&gt;</span>@color/text_dark2<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"text_color4"</span>&gt;</span>@color/text_dark1<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"bg2"</span>&gt;</span>@color/bg_dark<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"bg_toolbar"</span>&gt;</span>@color/bg_dark_content<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>当然字体颜色最好写颜色名，可以自定一些文字属性，比如TextPrimaryColor、TextSecondColor、TextThirdColor,TextSizeBig、TextSizeMedium等等。</p>
<h4 id="6-其它需要改进的地方"><a href="#6-其它需要改进的地方" class="headerlink" title="6. 其它需要改进的地方"></a>6. 其它需要改进的地方</h4><p>项目中笔者为了实现方便，在Holder中需要使用到Context的地方使用了强转的方式，比如需要点击一个Item跳转到另一个界面，笔者一般是这样做的：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">itemView.setOnClickListener(<span class="keyword">new</span> OnClickListener&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span></span>&#123;</div><div class="line">        ((Activity)context).startActivity(context,DetailActivity.class);</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>这里使用了暴力强转的方式，因为一个View所属的context必然是一个Activity（不可能是Application、Service，Dialog实际上也是Activity），这样的做法虽然也可用，但还是有一些隐患的，有可能会导致Crash。所以笔者建议可以试试使用EventBus来处理这样的事件。</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://yoursite.com/2016/09/13/友书：我的Android项目搭建规范与技巧塑造之旅/" data-id="cit2bxyge001kpw5oflpgfy02" class="article-share-link">分享到</a><div class="tags"><a href="/tags/项目规范/">项目规范</a></div><div class="post-nav"><a href="/2016/08/20/Android插件化/" class="next">Android应用插件化原理与实现（待续）</a></div><div data-thread-key="2016/09/13/友书：我的Android项目搭建规范与技巧塑造之旅/" data-title="友书：我的Android项目搭建规范与技巧塑造之旅" data-url="http://yoursite.com/2016/09/13/友书：我的Android项目搭建规范与技巧塑造之旅/" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">分享到：</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div><div data-thread-key="2016/09/13/友书：我的Android项目搭建规范与技巧塑造之旅/" data-title="友书：我的Android项目搭建规范与技巧塑造之旅" data-url="http://yoursite.com/2016/09/13/友书：我的Android项目搭建规范与技巧塑造之旅/" data-author-key="1" class="ds-thread"></div><div id="disqus_thread"><script>var disqus_shortname = 'lcodecore';
var disqus_identifier = '2016/09/13/友书：我的Android项目搭建规范与技巧塑造之旅/';
var disqus_title = '友书：我的Android项目搭建规范与技巧塑造之旅';
var disqus_url = 'http://yoursite.com/2016/09/13/友书：我的Android项目搭建规范与技巧塑造之旅/';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//lcodecore.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/JNI/" style="font-size: 15px;">JNI</a> <a href="/tags/安全/" style="font-size: 15px;">安全</a> <a href="/tags/学习/" style="font-size: 15px;">学习</a> <a href="/tags/响应式编程/" style="font-size: 15px;">响应式编程</a> <a href="/tags/项目搭建/" style="font-size: 15px;">项目搭建</a> <a href="/tags/设计模式/" style="font-size: 15px;">设计模式</a> <a href="/tags/整理/" style="font-size: 15px;">整理</a> <a href="/tags/项目规范/" style="font-size: 15px;">项目规范</a> <a href="/tags/求职/" style="font-size: 15px;">求职</a> <a href="/tags/算法/" style="font-size: 15px;">算法</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/09/13/友书：我的Android项目搭建规范与技巧塑造之旅/">友书：我的Android项目搭建规范与技巧塑造之旅</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/20/Android插件化/">Android应用插件化原理与实现（待续）</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/20/Android热补丁动态修复HotFix/">Android热补丁动态修复技术Hotfix</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/18/Android代码混淆详解/">Android代码混淆详解</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/18/adapter深入理解学习/">Adapter学习与优化</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/12/Android SQLite操作性能优化办法(参考GreenDao)/">Android SQLite操作性能优化办法-参考GreenDao</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/10/SQL学习/">SQL学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/08/Android应用差分更新工具bsdiff/">Android应用差分更新工具bsdiff</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/01/Android网络请求实现及okhttp源码浅析/">Android网络请求实现与okhttp源码浅析</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/01/Android进程间通信AIDL(Android接口定义语言)/">Android进程间通信AIDL</a></li></ul></div><div class="widget"><div class="comments-title"><i class="fa fa-comment-o"> 最近评论</i></div><div data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-admin="0" data-excerpt-length="32" data-show-title="1" class="ds-recent-comments"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> 最近评论</i></div><script type="text/javascript" src="//lcodecore.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://github.com/lcodecorex" title="github" target="_blank">github</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">Oscar Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>var duoshuoQuery = {short_name:'超歌'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>